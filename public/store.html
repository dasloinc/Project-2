<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Store</title>
  <script src="https://code.jquery.com/jquery.js"></script>
  <link rel="stylesheet" href="assets/css/style.css" media="screen" title="no title">
  <link rel="stylesheet" href="assets/css/footer.css" media="screen" title="no title">
  <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"> -->
    
</head>
<body>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    
        <div class="contaner">
            <div class="top-bar">
                <div class="top-bar-left">
                    <ul class="menu1">
                        <li class="menu-text">The Pharmacy</li>
                    </ul>
                </div>
                <div class="top-bar-right">
                    <ul class="menu">
                        <li>
                            <a class="nav-item nav-link active" href="homepage.html">Home</a>
                        </li>
                        <li>
                            <a class="nav-item nav-link" href="profile.html">Profile</a>
                        </li>
                        <li>
                            <div class="dropdown">
                                <!-- <button class="dropbtn">Store  -->
                                  <i class="fa fa-caret-down"><a class="nav-item nav-link" href="store.html">Store</a></i>
                                </button>
                                <div class="dropdown-content">
                                  <a href="#">Link 1</a>
                                  <a href="#">Link 2</a>
                                  <a href="#">Link 3</a>
                                </div>
                            </div> 
                        </li>                       
                        <li>
                            <a class="nav-item nav-link" href="checkout.html">Check out</a>
                        </li>                    
                    </ul>
                </div> 
            </div>     
        </div>
        </div>


    <div class="row column text-center">
      <h2>Our Newest Products</h2>
      <hr>
    </div>
    <div class="row">
      <div class="col-lg-12">
  
          <label for="reserve-unique-id"
          >Route</label
        >
      
          <select
          name="field_12"
          type="text"
          class="form-control"
          id="route"
          required
        ></select>
      
        <label for="reserve-unique-id"
        >Dosage Form</label
      >
      
        <select
        name="field_12"
        type="text"
        class="form-control"
        id="dosageForm"
        required
      ></select>
      
        <br>
        <button type="submit" id="checkName" class="button btn-primary submit">
          Check
        </button>
      
          
  
  
      </div>
  
  
  </div>


   

    <div class="row small-up-2 large-up-4" id="drugList">
    
    </div>

    <hr>

    <div class="row column">
      <div class="callout primary">
        <h3>Really big special this week on items.</h3>
      </div>
    </div>

    <hr>

    <div class="row column text-center">
      <h2>Some Other Neat Products</h2>
      <hr>
    </div>

  
   
<script>
    console.log("hello")
    var getRoutes = 'https://api.fda.gov/drug/ndc.json?count=route';
    var getDosageForm = 'https://api.fda.gov/drug/ndc.json?count=dosage_form';
    var drugArray =[]

    getRoutesFunction()
    getDosageFormFunction()

    $("#checkName").on("click", function (e) {
        e.preventDefault();

    console.log("clicked")
    var dosageForm = $("#dosageForm").val().trim();
    var route = $("#route").val().trim();

    getDrugList(route, dosageForm);
    });

    $("#drugList").on("click", function (e) {
        e.preventDefault();
        console.log("clicked buydrug")
        console.log(e.target.id)
        console.log(drugArray)

        var newDrugSave={

          user: "Dmitri",
          brand_name: drugArray.results[e.target.id].brand_name,
          labeler_name: drugArray.results[e.target.id].labeler_name,
          marketing_start_date: drugArray.results[e.target.id].marketing_start_date,
          product_id: drugArray.results[e.target.id].spl_id,
          price: "400"

        }

        console.log(newDrugSave);

        $.post("/api/posts", newDrugSave,
      function(data) {

       
        if (data) {
          alert("Thank you, Drug Submitted");
          location.reload();

        }

        
        else {
          alert("Something went wrong ...");
         
        }
      });


  
    });

    function getDrugList(route, dosageForm){

    var base = 'https://api.fda.gov/drug/ndc.json?count=';
    var uri = `https://api.fda.gov/drug/ndc.json?search=route:${route}+AND+dosage_form=${dosageForm}&limit=12`;

    $.ajax({
        url: uri,
        method: "GET"
      }).then(function(response){
        console.log(response)
        drugArray =response;
    
    for (let index = 0; index < response.results.length; index++) {
            $("#drugList").append(`
            <div class="column">
        <img class="thumbnail" src="https://picsum.photos/300/400?random=${index}">
        <h5>${response.results[index].brand_name}</h5>
        <p>${response.results[index].labeler_name}</p>
        <p>$400</p>
        <a href="#" class="button expanded buyDrug" id="${index}">Buy</a>
      </div>
            
    `);
        } 
    })
    };

    function getDosageFormFunction(){

        $.ajax({
        url: getDosageForm,
        method: "GET"
        }).then(function(response){
        console.log(response)
    
        for (let index = 0; index < response.results.length; index++) {
        $("#dosageForm").append("<option>"+ response.results[index].term+ "</option>" )}
    })
    };


    function getRoutesFunction(){

    $.ajax({
    url: getRoutes,
    method: "GET"
    }).then(function(response){
    console.log(response)
    
    for (let index = 0; index < response.results.length; index++) {
        $("#route").append("<option>"+ response.results[index].term+ "</option>" )
    }
    })
    };
    </script>
</body>
</html>